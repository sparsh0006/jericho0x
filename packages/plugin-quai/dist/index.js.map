{"version":3,"sources":["../src/actions/transfer.ts","../src/utils/index.ts","../src/index.ts"],"sourcesContent":["import {\r\n    ActionExample,\r\n    HandlerCallback,\r\n    IAgentRuntime,\r\n    Memory,\r\n    ModelClass,\r\n    State,\r\n    type Action,\r\n    composeContext,\r\n    generateObject,\r\n} from \"@elizaos/core\";\r\nimport {\r\n    getQuaiAccount,\r\n    isTransferContent,\r\n    validateSettings,\r\n} from \"../utils\";\r\nimport { formatUnits, TransactionRequest } from \"quais\";\r\n\r\nconst transferTemplate = `Respond with a JSON markdown block containing only the extracted values. Use null for any values that cannot be determined.\r\n\r\nExample response:\r\n\\`\\`\\`json\r\n{\r\n    \"tokenAddress\": \"0x49d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7\",\r\n    \"recipient\": \"0x0005C06bD1339c79700a8DAb35DE0a1b61dFBD71\",\r\n    \"amount\": \"0.001\"\r\n}\r\n\\`\\`\\`\r\n\r\n{{recentMessages}}\r\n\r\nGiven the recent messages, extract the following information about the requested token transfer:\r\n- Token contract address (if available)\r\n- Recipient wallet address\r\n- Amount to send\r\n\r\nRespond with a JSON markdown block containing only the extracted values.`;\r\n\r\nexport default {\r\n    name: \"SEND_TOKEN\",\r\n    similes: [\r\n        \"TRANSFER_TOKEN_ON_QUAI\",\r\n        \"TRANSFER_TOKENS_ON_QUAI\",\r\n        \"SEND_TOKENS_ON_QUAI\",\r\n        \"SEND_QUAI\",\r\n        \"PAY_ON_QUAI\",\r\n    ],\r\n    validate: async (runtime: IAgentRuntime, message: Memory) => {\r\n        return validateSettings(runtime);\r\n    },\r\n    description:\r\n        \"MUST use this action if the user requests send a token or transfer a token, the request might be varied, but it will always be a token transfer. If the user requests a transfer of lords, use this action.\",\r\n    handler: async (\r\n        runtime: IAgentRuntime,\r\n        message: Memory,\r\n        state: State,\r\n        _options: { [key: string]: unknown },\r\n        callback?: HandlerCallback\r\n    ): Promise<boolean> => {\r\n        console.log(\"Starting TRANSFER_TOKEN handler...\");\r\n\r\n        // Initialize or update state\r\n        if (!state) {\r\n            state = (await runtime.composeState(message)) as State;\r\n        } else {\r\n            state = await runtime.updateRecentMessageState(state);\r\n        }\r\n\r\n        // Compose transfer context\r\n        const transferContext = composeContext({\r\n            state,\r\n            template: transferTemplate,\r\n        });\r\n\r\n        // Generate transfer content\r\n        const content = await generateObject({\r\n            runtime,\r\n            context: transferContext,\r\n            modelClass: ModelClass.MEDIUM,\r\n        });\r\n\r\n        console.log(\"Transfer content:\", content);\r\n\r\n        // Validate transfer content\r\n        if (!isTransferContent(content)) {\r\n            console.error(\"Invalid content for TRANSFER_TOKEN action.\");\r\n            if (callback) {\r\n                callback({\r\n                    text: \"Not enough information to transfer tokens. Please respond with token address, recipient, and amount.\",\r\n                    content: { error: \"Invalid transfer content\" },\r\n                });\r\n            }\r\n            return false;\r\n        }\r\n\r\n        try {\r\n            const account = getQuaiAccount(runtime);\r\n            const amount =  formatUnits(content.amount, \"wei\");\r\n\r\n            var txObj: TransactionRequest = {};\r\n            if (content.tokenAddress) {\r\n                // TODO: transfer QRC20s\r\n            } else {\r\n                txObj = {\r\n                    to:  content.recipient,\r\n                    value: amount,\r\n                    from: account.address,\r\n                };\r\n\r\n                console.log(\r\n                    \"Transferring\",\r\n                    amount,\r\n                    \"QUAI\",\r\n                    \"to\",\r\n                    content.recipient\r\n                );\r\n            }\r\n\r\n            const tx = await account.sendTransaction(txObj)\r\n\r\n            console.log(\r\n                \"Transfer completed successfully! tx: \" + tx.hash\r\n            );\r\n            if (callback) {\r\n                callback({\r\n                    text:\r\n                        \"Transfer completed successfully! tx: \" +\r\n                        tx.hash,\r\n                    content: {},\r\n                });\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            console.error(\"Error during token transfer:\", error);\r\n            if (callback) {\r\n                callback({\r\n                    text: `Error transferring tokens: ${error.message}`,\r\n                    content: { error: error.message },\r\n                });\r\n            }\r\n            return false;\r\n        }\r\n    },\r\n\r\n    examples: [\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: {\r\n                    text: \"Send 10 QUAI to 0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7\",\r\n                },\r\n            },\r\n            {\r\n                user: \"{{agent}}\",\r\n                content: {\r\n                    text: \"I'll transfer 10 QUAI to that address right away. Let me process that for you.\",\r\n                },\r\n            },\r\n        ],\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: {\r\n                    text: \"Please send 0.5 QUAI to 0x03fe2b97c1fd336e750087d68b9b867997fd64a2661ff3ca5a7c771641e8e7ac\",\r\n                },\r\n            },\r\n            {\r\n                user: \"{{agent}}\",\r\n                content: {\r\n                    text: \"Got it, initiating transfer of 0.5 QUAI to the provided address. I'll confirm once it's complete.\",\r\n                },\r\n            },\r\n        ],\r\n    ] as ActionExample[][],\r\n} as Action;\r\n","import { Content, IAgentRuntime } from \"@elizaos/core\";\r\nimport { JsonRpcProvider, Wallet } from \"quais\";\r\n\r\nexport const validateSettings = (runtime: IAgentRuntime) => {\r\n    const requiredSettings = [\r\n        \"QUAI_PRIVATE_KEY\",\r\n        \"QUAI_RPC_URL\",\r\n    ];\r\n\r\n    for (const setting of requiredSettings) {\r\n        if (!runtime.getSetting(setting)) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nexport const getQuaiProvider = (runtime: IAgentRuntime) => {\r\n    return new JsonRpcProvider(\r\n        runtime.getSetting(\"QUAI_RPC_URL\"),\r\n    );\r\n};\r\n\r\nexport const getQuaiAccount = (runtime: IAgentRuntime) => {\r\n    const provider = getQuaiProvider(runtime);\r\n    const account = new Wallet(runtime.getSetting(\"QUAI_PRIVATE_KEY\"), provider);\r\n    return account;\r\n};\r\n\r\nexport interface TransferContent extends Content {\r\n    tokenAddress: string;\r\n    recipient: string;\r\n    amount: string | number;\r\n}\r\n\r\nexport function isTransferContent(\r\n    content: any\r\n): content is TransferContent {\r\n    // Validate types\r\n    const validTypes =\r\n        (content.tokenAddress === null || typeof content.tokenAddress === \"string\") &&\r\n        typeof content.recipient === \"string\" &&\r\n        (typeof content.amount === \"string\" ||\r\n            typeof content.amount === \"number\");\r\n    if (!validTypes) {\r\n        return false;\r\n    }\r\n\r\n    // Validate addresses (20-bytes with 0x prefix)\r\n    const validRecipient =\r\n        content.recipient.startsWith(\"0x\") &&\r\n        content.recipient.length === 42;\r\n\r\n    // If tokenAddress is provided, validate it\r\n    const validTokenAddress = content.tokenAddress === null ||\r\n        (content.tokenAddress.startsWith(\"0x\") &&\r\n        content.tokenAddress.length === 42);\r\n\r\n    return validRecipient && validTokenAddress;\r\n}\r\n","import { Plugin } from \"@elizaos/core\";\r\nimport transfer from \"./actions/transfer\";\r\n\r\nexport const quaiPlugin: Plugin = {\r\n    name: \"quai\",\r\n    description: \"Quai Plugin for Eliza\",\r\n    actions: [transfer],\r\n    evaluators: [],\r\n    providers: [],\r\n};\r\n\r\nexport default quaiPlugin;\r\n"],"mappings":"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","names":[]}