{"version":3,"sources":["../src/providers/wallet.ts","../src/actions/swap.ts","../src/actions/transfer.ts","../src/index.ts"],"names":["elizaLogger","keyStores","utils","connect","nearUtils","composeContext","generateObject","ModelClass"],"mappings":"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","file":"index.js","sourcesContent":["import {\r\n    IAgentRuntime,\r\n    Memory,\r\n    Provider,\r\n    State,\r\n    elizaLogger,\r\n} from \"@elizaos/core\";\r\nimport { KeyPair, keyStores, connect, Account, utils } from \"near-api-js\";\r\nimport BigNumber from \"bignumber.js\";\r\nimport { KeyPairString } from \"near-api-js/lib/utils\";\r\nimport NodeCache from \"node-cache\";\r\n\r\nconst PROVIDER_CONFIG = {\r\n    networkId: process.env.NEAR_NETWORK || \"testnet\",\r\n    nodeUrl:\r\n        process.env.NEAR_RPC_URL ||\r\n        `https://rpc.${process.env.NEAR_NETWORK || \"testnet\"}.near.org`,\r\n    walletUrl: `https://${process.env.NEAR_NETWORK || \"testnet\"}.mynearwallet.com/`,\r\n    helperUrl: `https://helper.${process.env.NEAR_NETWORK || \"testnet\"}.near.org`,\r\n    explorerUrl: `https://${process.env.NEAR_NETWORK || \"testnet\"}.nearblocks.io`,\r\n    MAX_RETRIES: 3,\r\n    RETRY_DELAY: 2000,\r\n    SLIPPAGE: process.env.NEAR_SLIPPAGE ? parseInt(process.env.NEAR_SLIPPAGE) : 1,\r\n};\r\n\r\nexport interface NearToken {\r\n    name: string;\r\n    symbol: string;\r\n    decimals: number;\r\n    balance: string;\r\n    uiAmount: string;\r\n    priceUsd: string;\r\n    valueUsd: string;\r\n    valueNear?: string;\r\n}\r\n\r\ninterface WalletPortfolio {\r\n    totalUsd: string;\r\n    totalNear?: string;\r\n    tokens: Array<NearToken>;\r\n}\r\n\r\nexport class WalletProvider implements Provider {\r\n    private cache: NodeCache;\r\n    private account: Account | null = null;\r\n    private keyStore: keyStores.InMemoryKeyStore;\r\n    constructor(private accountId: string) {\r\n        this.cache = new NodeCache({ stdTTL: 300 }); // Cache TTL set to 5 minutes\r\n        this.keyStore = new keyStores.InMemoryKeyStore();\r\n    }\r\n\r\n    async get(\r\n        runtime: IAgentRuntime,\r\n        _message: Memory,\r\n        _state?: State\r\n    ): Promise<string | null> {\r\n        try {\r\n            return await this.getFormattedPortfolio(runtime);\r\n        } catch (error) {\r\n            elizaLogger.error(\"Error in wallet provider:\", error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    public async connect(runtime: IAgentRuntime) {\r\n        if (this.account) return this.account;\r\n\r\n        const secretKey = runtime.getSetting(\"NEAR_WALLET_SECRET_KEY\");\r\n        const publicKey = runtime.getSetting(\"NEAR_WALLET_PUBLIC_KEY\");\r\n\r\n        if (!secretKey || !publicKey) {\r\n            throw new Error(\"NEAR wallet credentials not configured\");\r\n        }\r\n\r\n        // Create KeyPair from secret key\r\n        const keyPair = KeyPair.fromString(secretKey as KeyPairString);\r\n\r\n        // Set the key in the keystore\r\n        await this.keyStore.setKey(\r\n            PROVIDER_CONFIG.networkId,\r\n            this.accountId,\r\n            keyPair\r\n        );\r\n\r\n        const nearConnection = await connect({\r\n            networkId: PROVIDER_CONFIG.networkId,\r\n            keyStore: this.keyStore,\r\n            nodeUrl: PROVIDER_CONFIG.nodeUrl,\r\n            walletUrl: PROVIDER_CONFIG.walletUrl,\r\n            helperUrl: PROVIDER_CONFIG.helperUrl,\r\n        });\r\n\r\n        this.account = await nearConnection.account(this.accountId);\r\n        return this.account;\r\n    }\r\n\r\n    private async fetchWithRetry(\r\n        url: string,\r\n        options: RequestInit = {}\r\n    ): Promise<any> {\r\n        let lastError: Error;\r\n\r\n        for (let i = 0; i < PROVIDER_CONFIG.MAX_RETRIES; i++) {\r\n            try {\r\n                const response = await fetch(url, options);\r\n                if (!response.ok) {\r\n                    throw new Error(`HTTP error! status: ${response.status}`);\r\n                }\r\n                return await response.json();\r\n            } catch (error) {\r\n                elizaLogger.error(`Attempt ${i + 1} failed:`, error);\r\n                lastError = error as Error;\r\n                if (i < PROVIDER_CONFIG.MAX_RETRIES - 1) {\r\n                    await new Promise((resolve) =>\r\n                        setTimeout(\r\n                            resolve,\r\n                            PROVIDER_CONFIG.RETRY_DELAY * Math.pow(2, i)\r\n                        )\r\n                    );\r\n                }\r\n            }\r\n        }\r\n        throw lastError!;\r\n    }\r\n\r\n    async fetchPortfolioValue(\r\n        runtime: IAgentRuntime\r\n    ): Promise<WalletPortfolio> {\r\n        try {\r\n            const cacheKey = `portfolio-${this.accountId}`;\r\n            const cachedValue = this.cache.get<WalletPortfolio>(cacheKey);\r\n\r\n            if (cachedValue) {\r\n                elizaLogger.log(\"Cache hit for fetchPortfolioValue\");\r\n                return cachedValue;\r\n            }\r\n\r\n            const account = await this.connect(runtime);\r\n            const balance = await account.getAccountBalance();\r\n\r\n            // Convert yoctoNEAR to NEAR\r\n            const nearBalance = utils.format.formatNearAmount(\r\n                balance.available\r\n            );\r\n\r\n            // Fetch NEAR price in USD\r\n            const nearPrice = await this.fetchNearPrice();\r\n            const valueUsd = new BigNumber(nearBalance).times(nearPrice);\r\n\r\n            const portfolio: WalletPortfolio = {\r\n                totalUsd: valueUsd.toString(),\r\n                totalNear: nearBalance,\r\n                tokens: [\r\n                    {\r\n                        name: \"NEAR Protocol\",\r\n                        symbol: \"NEAR\",\r\n                        decimals: 24,\r\n                        balance: balance.available,\r\n                        uiAmount: nearBalance,\r\n                        priceUsd: nearPrice.toString(),\r\n                        valueUsd: valueUsd.toString(),\r\n                    },\r\n                ],\r\n            };\r\n\r\n            this.cache.set(cacheKey, portfolio);\r\n            return portfolio;\r\n        } catch (error) {\r\n            elizaLogger.error(\"Error fetching portfolio:\", error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    private async fetchNearPrice(): Promise<number> {\r\n        const cacheKey = \"near-price\";\r\n        const cachedPrice = this.cache.get<number>(cacheKey);\r\n\r\n        if (cachedPrice) {\r\n            return cachedPrice;\r\n        }\r\n\r\n        try {\r\n            const response = await this.fetchWithRetry(\r\n                \"https://api.coingecko.com/api/v3/simple/price?ids=near&vs_currencies=usd\"\r\n            );\r\n            const price = response.near.usd;\r\n            this.cache.set(cacheKey, price);\r\n            return price;\r\n        } catch (error) {\r\n            elizaLogger.error(\"Error fetching NEAR price:\", error);\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    formatPortfolio(\r\n        runtime: IAgentRuntime,\r\n        portfolio: WalletPortfolio\r\n    ): string {\r\n        let output = `${runtime.character.system}\\n`;\r\n        output += `Account ID: ${this.accountId}\\n\\n`;\r\n\r\n        const totalUsdFormatted = new BigNumber(portfolio.totalUsd).toFixed(2);\r\n        const totalNearFormatted = portfolio.totalNear;\r\n\r\n        output += `Total Value: $${totalUsdFormatted} (${totalNearFormatted} NEAR)\\n\\n`;\r\n        output += \"Token Balances:\\n\";\r\n\r\n        for (const token of portfolio.tokens) {\r\n            output += `${token.name} (${token.symbol}): ${token.uiAmount} ($${new BigNumber(token.valueUsd).toFixed(2)})\\n`;\r\n        }\r\n\r\n        output += \"\\nMarket Prices:\\n\";\r\n        output += `NEAR: $${new BigNumber(portfolio.tokens[0].priceUsd).toFixed(2)}\\n`;\r\n\r\n        return output;\r\n    }\r\n\r\n    async getFormattedPortfolio(runtime: IAgentRuntime): Promise<string> {\r\n        try {\r\n            const portfolio = await this.fetchPortfolioValue(runtime);\r\n            return this.formatPortfolio(runtime, portfolio);\r\n        } catch (error) {\r\n            elizaLogger.error(\"Error generating portfolio report:\", error);\r\n            return \"Unable to fetch wallet information. Please try again later.\";\r\n        }\r\n    }\r\n}\r\n\r\nconst walletProvider: Provider = {\r\n    get: async (\r\n        runtime: IAgentRuntime,\r\n        _message: Memory,\r\n        _state?: State\r\n    ): Promise<string | null> => {\r\n        try {\r\n            const accountId = runtime.getSetting(\"NEAR_ADDRESS\");\r\n            if (!accountId) {\r\n                throw new Error(\"NEAR_ADDRESS not configured\");\r\n            }\r\n            const provider = new WalletProvider(accountId);\r\n            return await provider.getFormattedPortfolio(runtime);\r\n        } catch (error) {\r\n            elizaLogger.error(\"Error in wallet provider:\", error);\r\n            return null;\r\n        }\r\n    },\r\n};\r\n\r\nexport { walletProvider };\r\n","import {\r\n    ActionExample,\r\n    HandlerCallback,\r\n    elizaLogger,\r\n    IAgentRuntime,\r\n    Memory,\r\n    ModelClass,\r\n    State,\r\n    type Action,\r\n    composeContext,\r\n    generateObject,\r\n} from \"@elizaos/core\";\r\nimport { connect, keyStores, utils } from \"near-api-js\";\r\nimport {\r\n    init_env,\r\n    ftGetTokenMetadata,\r\n    estimateSwap,\r\n    instantSwap,\r\n    fetchAllPools,\r\n    FT_MINIMUM_STORAGE_BALANCE_LARGE,\r\n    ONE_YOCTO_NEAR,\r\n} from \"@ref-finance/ref-sdk\";\r\nimport { walletProvider } from \"../providers/wallet\";\r\nimport { KeyPairString } from \"near-api-js/lib/utils\";\r\n\r\nasync function checkStorageBalance(\r\n    account: any,\r\n    contractId: string\r\n): Promise<boolean> {\r\n    try {\r\n        const balance = await account.viewFunction({\r\n            contractId,\r\n            methodName: \"storage_balance_of\",\r\n            args: { account_id: account.accountId },\r\n        });\r\n        return balance !== null && balance.total !== \"0\";\r\n    } catch (error) {\r\n        elizaLogger.log(`Error checking storage balance: ${error}`);\r\n        return false;\r\n    }\r\n}\r\n\r\nasync function swapToken(\r\n    runtime: IAgentRuntime,\r\n    inputTokenId: string,\r\n    outputTokenId: string,\r\n    amount: string,\r\n    slippageTolerance: number = Number(\r\n        runtime.getSetting(\"SLIPPAGE_TOLERANCE\")\r\n    ) || 0.01\r\n): Promise<any> {\r\n    try {\r\n        // Get token metadata\r\n        const tokenIn = await ftGetTokenMetadata(inputTokenId);\r\n        const tokenOut = await ftGetTokenMetadata(outputTokenId);\r\n        const networkId = runtime.getSetting(\"NEAR_NETWORK\") || \"testnet\";\r\n        const nodeUrl =\r\n            runtime.getSetting(\"NEAR_RPC_URL\") || \"https://rpc.testnet.near.org\";\r\n\r\n        // Get all pools for estimation\r\n        // ratedPools, unRatedPools,\r\n        const { simplePools } = await fetchAllPools();\r\n        const swapTodos = await estimateSwap({\r\n            tokenIn,\r\n            tokenOut,\r\n            amountIn: amount,\r\n            simplePools,\r\n            options: {\r\n                enableSmartRouting: true,\r\n            },\r\n        });\r\n\r\n        if (!swapTodos || swapTodos.length === 0) {\r\n            throw new Error(\"No valid swap route found\");\r\n        }\r\n\r\n        // Get account ID from runtime settings\r\n        const accountId = runtime.getSetting(\"NEAR_ADDRESS\");\r\n        if (!accountId) {\r\n            throw new Error(\"NEAR_ADDRESS not configured\");\r\n        }\r\n\r\n        const secretKey = runtime.getSetting(\"NEAR_WALLET_SECRET_KEY\");\r\n        const keyStore = new keyStores.InMemoryKeyStore();\r\n        const keyPair = utils.KeyPair.fromString(secretKey as KeyPairString);\r\n        await keyStore.setKey(networkId, accountId, keyPair);\r\n\r\n        const nearConnection = await connect({\r\n            networkId,\r\n            keyStore,\r\n            nodeUrl,\r\n        });\r\n\r\n        const account = await nearConnection.account(accountId);\r\n\r\n        // Check storage balance for both tokens\r\n        const hasStorageIn = await checkStorageBalance(account, inputTokenId);\r\n        const hasStorageOut = await checkStorageBalance(account, outputTokenId);\r\n\r\n        const transactions = await instantSwap({\r\n            tokenIn,\r\n            tokenOut,\r\n            amountIn: amount,\r\n            swapTodos,\r\n            slippageTolerance,\r\n            AccountId: accountId,\r\n        });\r\n\r\n        // If storage deposit is needed, add it to transactions\r\n        if (!hasStorageIn) {\r\n            transactions.unshift({\r\n                receiverId: inputTokenId,\r\n                functionCalls: [\r\n                    {\r\n                        methodName: \"storage_deposit\",\r\n                        args: {\r\n                            account_id: accountId,\r\n                            registration_only: true,\r\n                        },\r\n                        gas: \"30000000000000\",\r\n                        amount: FT_MINIMUM_STORAGE_BALANCE_LARGE,\r\n                    },\r\n                ],\r\n            });\r\n        }\r\n\r\n        if (!hasStorageOut) {\r\n            transactions.unshift({\r\n                receiverId: outputTokenId,\r\n                functionCalls: [\r\n                    {\r\n                        methodName: \"storage_deposit\",\r\n                        args: {\r\n                            account_id: accountId,\r\n                            registration_only: true,\r\n                        },\r\n                        gas: \"30000000000000\",\r\n                        amount: FT_MINIMUM_STORAGE_BALANCE_LARGE,\r\n                    },\r\n                ],\r\n            });\r\n        }\r\n\r\n        return transactions;\r\n    } catch (error) {\r\n        elizaLogger.error(\"Error in swapToken:\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nconst swapTemplate = `Respond with a JSON markdown block containing only the extracted values. Use null for any values that cannot be determined.\r\n\r\nExample response:\r\n\\`\\`\\`json\r\n{\r\n    \"inputTokenId\": \"wrap.testnet\",\r\n    \"outputTokenId\": \"ref.fakes.testnet\",\r\n    \"amount\": \"1.5\"\r\n}\r\n\\`\\`\\`\r\n\r\n{{recentMessages}}\r\n\r\nGiven the recent messages and wallet information below:\r\n\r\n{{walletInfo}}\r\n\r\nExtract the following information about the requested token swap:\r\n- Input token ID (the token being sold)\r\n- Output token ID (the token being bought)\r\n- Amount to swap\r\n\r\nRespond with a JSON markdown block containing only the extracted values. Use null for any values that cannot be determined. The result should be a valid JSON object with the following schema:\r\n\\`\\`\\`json\r\n{\r\n    \"inputTokenId\": string | null,\r\n    \"outputTokenId\": string | null,\r\n    \"amount\": string | null\r\n}\r\n\\`\\`\\``;\r\n\r\nexport const executeSwap: Action = {\r\n    name: \"EXECUTE_SWAP_NEAR\",\r\n    similes: [\r\n        \"SWAP_TOKENS_NEAR\",\r\n        \"TOKEN_SWAP_NEAR\",\r\n        \"TRADE_TOKENS_NEAR\",\r\n        \"EXCHANGE_TOKENS_NEAR\",\r\n    ],\r\n    validate: async (_runtime: IAgentRuntime, message: Memory) => {\r\n        elizaLogger.log(\"Message:\", message);\r\n        return true;\r\n    },\r\n    description: \"Perform a token swap using Ref Finance.\",\r\n    handler: async (\r\n        runtime: IAgentRuntime,\r\n        message: Memory,\r\n        state: State,\r\n        _options: { [key: string]: unknown },\r\n        callback?: HandlerCallback\r\n    ): Promise<boolean> => {\r\n        // Initialize Ref SDK with testnet environment\r\n        init_env(runtime.getSetting(\"NEAR_NETWORK\") || \"testnet\");\r\n        // Compose state\r\n        if (!state) {\r\n            state = (await runtime.composeState(message)) as State;\r\n        } else {\r\n            state = await runtime.updateRecentMessageState(state);\r\n        }\r\n\r\n        const walletInfo = await walletProvider.get(runtime, message, state);\r\n        state.walletInfo = walletInfo;\r\n\r\n        const swapContext = composeContext({\r\n            state,\r\n            template: swapTemplate,\r\n        });\r\n\r\n        const response = await generateObject({\r\n            runtime,\r\n            context: swapContext,\r\n            modelClass: ModelClass.LARGE,\r\n        });\r\n\r\n        elizaLogger.log(\"Response:\", response);\r\n\r\n        if (\r\n            !response.inputTokenId ||\r\n            !response.outputTokenId ||\r\n            !response.amount\r\n        ) {\r\n            elizaLogger.log(\"Missing required parameters, skipping swap\");\r\n            const responseMsg = {\r\n                text: \"I need the input token ID, output token ID, and amount to perform the swap\",\r\n            };\r\n            callback?.(responseMsg);\r\n            return true;\r\n        }\r\n\r\n        try {\r\n            // Get account credentials\r\n            const accountId = runtime.getSetting(\"NEAR_ADDRESS\");\r\n            const secretKey = runtime.getSetting(\"NEAR_WALLET_SECRET_KEY\");\r\n\r\n            if (!accountId || !secretKey) {\r\n                throw new Error(\"NEAR wallet credentials not configured\");\r\n            }\r\n\r\n            // Create keystore and connect to NEAR\r\n            const keyStore = new keyStores.InMemoryKeyStore();\r\n            const keyPair = utils.KeyPair.fromString(\r\n                secretKey as KeyPairString\r\n            );\r\n            await keyStore.setKey(\"testnet\", accountId, keyPair);\r\n\r\n            const nearConnection = await connect({\r\n                networkId: runtime.getSetting(\"NEAR_NETWORK\") || \"testnet\",\r\n                keyStore,\r\n                nodeUrl:\r\n                    runtime.getSetting(\"NEAR_RPC_URL\") ||\r\n                    \"https://rpc.testnet.near.org\",\r\n            });\r\n\r\n            // Execute swap\r\n            const swapResult = await swapToken(\r\n                runtime,\r\n                response.inputTokenId,\r\n                response.outputTokenId,\r\n                response.amount,\r\n                Number(runtime.getSetting(\"SLIPPAGE_TOLERANCE\")) || 0.01\r\n            );\r\n\r\n            // Sign and send transactions\r\n            const account = await nearConnection.account(accountId);\r\n            const results = [];\r\n\r\n            for (const tx of swapResult) {\r\n                for (const functionCall of tx.functionCalls) {\r\n                    const result = await account.functionCall({\r\n                        contractId: tx.receiverId,\r\n                        methodName: functionCall.methodName,\r\n                        args: functionCall.args,\r\n                        gas: functionCall.gas,\r\n                        attachedDeposit: BigInt(\r\n                            functionCall.amount === ONE_YOCTO_NEAR\r\n                                ? \"1\"\r\n                                : functionCall.amount\r\n                        ),\r\n                    });\r\n                    results.push(result);\r\n                }\r\n            }\r\n\r\n            elizaLogger.log(\"Swap completed successfully!\");\r\n            const txHashes = results.map((r) => r.transaction.hash).join(\", \");\r\n\r\n            const responseMsg = {\r\n                text: `Swap completed successfully! Transaction hashes: ${txHashes}`,\r\n            };\r\n\r\n            callback?.(responseMsg);\r\n            return true;\r\n        } catch (error) {\r\n            elizaLogger.error(\"Error during token swap:\", error);\r\n            const responseMsg = {\r\n                text: `Error during swap: ${error instanceof Error ? error.message : String(error)}`,\r\n            };\r\n            callback?.(responseMsg);\r\n            return false;\r\n        }\r\n    },\r\n    examples: [\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: {\r\n                    inputTokenId: \"wrap.testnet\",\r\n                    outputTokenId: \"ref.fakes.testnet\",\r\n                    amount: \"1.0\",\r\n                },\r\n            },\r\n            {\r\n                user: \"{{user2}}\",\r\n                content: {\r\n                    text: \"Swapping 1.0 NEAR for REF...\",\r\n                    action: \"TOKEN_SWAP\",\r\n                },\r\n            },\r\n            {\r\n                user: \"{{user2}}\",\r\n                content: {\r\n                    text: \"Swap completed successfully! Transaction hash: ...\",\r\n                },\r\n            },\r\n        ],\r\n    ] as ActionExample[][],\r\n} as Action;\r\n","import {\r\n    ActionExample,\r\n    Content,\r\n    HandlerCallback,\r\n    IAgentRuntime,\r\n    Memory,\r\n    ModelClass,\r\n    State,\r\n    elizaLogger,\r\n    type Action,\r\n    composeContext,\r\n    generateObject,\r\n} from \"@elizaos/core\";\r\nimport { connect, keyStores, utils } from \"near-api-js\";\r\nimport { KeyPairString } from \"near-api-js/lib/utils\";\r\nimport { utils as nearUtils } from \"near-api-js\";\r\n// import BigNumber from \"bignumber.js\";\r\n\r\nexport interface TransferContent extends Content {\r\n    recipient: string;\r\n    amount: string | number;\r\n    tokenAddress?: string; // Optional for native NEAR transfers\r\n}\r\n\r\nfunction isTransferContent(\r\n    runtime: IAgentRuntime,\r\n    content: any\r\n): content is TransferContent {\r\n    return (\r\n        typeof content.recipient === \"string\" &&\r\n        (typeof content.amount === \"string\" ||\r\n            typeof content.amount === \"number\")\r\n    );\r\n}\r\n\r\nconst transferTemplate = `Respond with a JSON markdown block containing only the extracted values. Use null for any values that cannot be determined.\r\n\r\nExample response:\r\n\\`\\`\\`json\r\n{\r\n    \"recipient\": \"bob.near\",\r\n    \"amount\": \"1.5\",\r\n    \"tokenAddress\": null\r\n}\r\n\\`\\`\\`\r\n\r\n{{recentMessages}}\r\n\r\nGiven the recent messages and wallet information below:\r\n\r\n{{walletInfo}}\r\n\r\nExtract the following information about the requested token transfer:\r\n- Recipient address (NEAR account)\r\n- Amount to transfer\r\n- Token contract address (null for native NEAR transfers)\r\n\r\nRespond with a JSON markdown block containing only the extracted values.`;\r\n\r\nasync function transferNEAR(\r\n    runtime: IAgentRuntime,\r\n    recipient: string,\r\n    amount: string\r\n): Promise<string> {\r\n    const networkId = runtime.getSetting(\"NEAR_NETWORK\") || \"testnet\";\r\n    const nodeUrl =\r\n        runtime.getSetting(\"NEAR_RPC_URL\") || \"https://rpc.testnet.near.org\";\r\n    const accountId = runtime.getSetting(\"NEAR_ADDRESS\");\r\n    const secretKey = runtime.getSetting(\"NEAR_WALLET_SECRET_KEY\");\r\n\r\n    if (!accountId || !secretKey) {\r\n        throw new Error(\"NEAR wallet credentials not configured\");\r\n    }\r\n\r\n    // Convert amount to yoctoNEAR (1 NEAR = 10^24 yoctoNEAR)\r\n    // const yoctoAmount = new BigNumber(amount).multipliedBy(new BigNumber(10).pow(24)).toFixed(0);\r\n\r\n    // Create keystore and connect to NEAR\r\n    const keyStore = new keyStores.InMemoryKeyStore();\r\n    const keyPair = utils.KeyPair.fromString(secretKey as KeyPairString);\r\n    await keyStore.setKey(networkId, accountId, keyPair);\r\n\r\n    const nearConnection = await connect({\r\n        networkId,\r\n        keyStore,\r\n        nodeUrl,\r\n    });\r\n\r\n    const account = await nearConnection.account(accountId);\r\n\r\n    // Execute transfer\r\n    const result = await account.sendMoney(\r\n        recipient,\r\n        BigInt(nearUtils.format.parseNearAmount(amount)!)\r\n    );\r\n\r\n    return result.transaction.hash;\r\n}\r\n\r\nexport const executeTransfer: Action = {\r\n    name: \"SEND_NEAR\",\r\n    similes: [\"TRANSFER_NEAR\", \"SEND_TOKENS\", \"TRANSFER_TOKENS\", \"PAY_NEAR\"],\r\n    validate: async (_runtime: IAgentRuntime, _message: Memory) => {\r\n        return true; // Add your validation logic here\r\n    },\r\n    description: \"Transfer NEAR tokens to another account\",\r\n    handler: async (\r\n        runtime: IAgentRuntime,\r\n        message: Memory,\r\n        state: State,\r\n        _options: { [key: string]: unknown },\r\n        callback?: HandlerCallback\r\n    ): Promise<boolean> => {\r\n        // Initialize or update state\r\n        if (!state) {\r\n            state = (await runtime.composeState(message)) as State;\r\n        } else {\r\n            state = await runtime.updateRecentMessageState(state);\r\n        }\r\n\r\n        // Compose transfer context\r\n        const transferContext = composeContext({\r\n            state,\r\n            template: transferTemplate,\r\n        });\r\n\r\n        // Generate transfer content\r\n        const content = await generateObject({\r\n            runtime,\r\n            context: transferContext,\r\n            modelClass: ModelClass.SMALL,\r\n        });\r\n\r\n        // Validate transfer content\r\n        if (!isTransferContent(runtime, content)) {\r\n            elizaLogger.error(\"Invalid content for TRANSFER_NEAR action.\");\r\n            if (callback) {\r\n                callback({\r\n                    text: \"Unable to process transfer request. Invalid content provided.\",\r\n                    content: { error: \"Invalid transfer content\" },\r\n                });\r\n            }\r\n            return false;\r\n        }\r\n\r\n        try {\r\n            const txHash = await transferNEAR(\r\n                runtime,\r\n                content.recipient,\r\n                content.amount.toString()\r\n            );\r\n\r\n            if (callback) {\r\n                callback({\r\n                    text: `Successfully transferred ${content.amount} NEAR to ${content.recipient}\\nTransaction: ${txHash}`,\r\n                    content: {\r\n                        success: true,\r\n                        signature: txHash,\r\n                        amount: content.amount,\r\n                        recipient: content.recipient,\r\n                    },\r\n                });\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            elizaLogger.error(\"Error during NEAR transfer:\", error);\r\n            if (callback) {\r\n                callback({\r\n                    text: `Error transferring NEAR: ${error}`,\r\n                    content: { error: error },\r\n                });\r\n            }\r\n            return false;\r\n        }\r\n    },\r\n\r\n    examples: [\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: {\r\n                    text: \"Send 1.5 NEAR to bob.testnet\",\r\n                },\r\n            },\r\n            {\r\n                user: \"{{user2}}\",\r\n                content: {\r\n                    text: \"I'll send 1.5 NEAR now...\",\r\n                    action: \"SEND_NEAR\",\r\n                },\r\n            },\r\n            {\r\n                user: \"{{user2}}\",\r\n                content: {\r\n                    text: \"Successfully sent 1.5 NEAR to bob.testnet\\nTransaction: ABC123XYZ\",\r\n                },\r\n            },\r\n        ],\r\n    ] as ActionExample[][],\r\n} as Action;\r\n","import { Plugin } from \"@elizaos/core/src/types\";\r\nimport { walletProvider } from \"./providers/wallet\";\r\n// import { executeCreateToken } from \"./actions/createToken\";\r\nimport { executeSwap } from \"./actions/swap\";\r\nimport { executeTransfer } from \"./actions/transfer\";\r\n\r\nexport const nearPlugin: Plugin = {\r\n    name: \"NEAR\",\r\n    description: \"Near Protocol Plugin for Eliza\",\r\n    providers: [walletProvider],\r\n    actions: [executeSwap, executeTransfer],\r\n    evaluators: [],\r\n};\r\n\r\nexport default nearPlugin;\r\n"]}